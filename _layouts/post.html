---
layout: default
---

{% comment %}
  This layout shows:
  1. The project/post content itself (pinned at top)
  2. All posts with the same tag, sorted by date descending
  
  For projects: shows project content + related posts
  For posts: shows post content (no additional listing needed)
  
  Handles both single tag (page.tag) and multiple tags (page.tags) for backward compatibility
{% endcomment %}

{{ content }}

{% comment %} Show related posts for projects {% endcomment %}
{% assign project_tags = page.tags | default: page.tag %}
{% if project_tags and page.path contains '_projects' %}
  {% if project_tags.first %}
    {% comment %} Multiple tags (array) {% endcomment %}
    {% assign related_posts = '' | split: '' %}
    {% for tag in project_tags %}
      {% assign posts_with_tag = site.posts | where_exp: "post", "post.tags contains tag" %}
      {% assign related_posts = related_posts | concat: posts_with_tag %}
    {% endfor %}
    {% assign related_posts = related_posts | uniq | sort: 'date' | reverse %}
  {% else %}
    {% comment %} Single tag (string) {% endcomment %}
    {% assign related_posts = site.posts | where_exp: "post", "post.tags contains project_tags" | sort: 'date' | reverse %}
  {% endif %}
  
  {% if related_posts.size > 0 %}
    <h2>Posts</h2>
    <ul>
      {% for post in related_posts %}
      <li>
        <span class="post-date">{{ post.date | date: "%Y-%m-%d" }}</span> 
        <a href="{{ post.url | relative_url }}">{{ post.title }}</a>
      </li>
      {% endfor %}
    </ul>
  {% endif %}
{% endif %}

